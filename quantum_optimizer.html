<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öõÔ∏è Quantum Structural Optimizer | BlueQubit</title>
    <meta name="description" content="Optimize structural members using quantum computing with BlueQubit API">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --text-primary: #f0f0f5;
            --text-secondary: #8888aa;
            --accent-quantum: #7c3aed;
            --accent-blue: #3b82f6;
            --accent-cyan: #06b6d4;
            --accent-green: #10b981;
            --accent-orange: #f59e0b;
            --accent-red: #ef4444;
            --gradient-quantum: linear-gradient(135deg, #7c3aed 0%, #3b82f6 50%, #06b6d4 100%);
            --glow-quantum: 0 0 40px rgba(124, 58, 237, 0.3);
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Background animation */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(124, 58, 237, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 32px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--gradient-quantum);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .quantum-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(124, 58, 237, 0.15);
            border: 1px solid rgba(124, 58, 237, 0.3);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #a78bfa;
            margin-top: 12px;
        }

        .quantum-badge::before {
            content: '‚öõÔ∏è';
        }

        /* Main Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 340px 1fr 340px;
            gap: 24px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Panels */
        .panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 24px;
            backdrop-filter: blur(10px);
        }

        .panel h2 {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel h2 .icon {
            font-size: 1.1rem;
        }

        /* Control Groups */
        .control-group {
            margin-bottom: 24px;
        }

        .control-group h3 {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(6, 182, 212, 0.2);
        }

        /* Sliders */
        .slider-row {
            margin-bottom: 16px;
        }

        .slider-row label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .slider-row label span:last-child {
            font-weight: 600;
            color: var(--accent-cyan);
            font-family: 'JetBrains Mono', monospace;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--gradient-quantum);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--glow-quantum);
            transition: transform 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        /* 3D View */
        .view-3d {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }

        #structure-canvas {
            width: 100%;
            height: 450px;
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            margin-top: 16px;
        }

        .status-bar .status-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: pulse 2s infinite;
        }

        .status-indicator.warning {
            background: var(--accent-orange);
        }

        .status-indicator.error {
            background: var(--accent-red);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.6;
                transform: scale(0.9);
            }
        }

        /* Optimize Button */
        .btn-optimize {
            background: var(--gradient-quantum);
            color: white;
            border: none;
            padding: 14px 28px;
            font-size: 0.9rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: var(--glow-quantum);
        }

        .btn-optimize:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(124, 58, 237, 0.4);
        }

        .btn-optimize:active {
            transform: translateY(0);
        }

        .btn-optimize.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .btn-optimize .spinner {
            display: none;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .btn-optimize.loading .spinner {
            display: block;
        }

        .btn-optimize.loading .btn-text {
            display: none;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Results Grid */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .result-card {
            background: rgba(255, 255, 255, 0.04);
            border-radius: 14px;
            padding: 16px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .result-card:hover {
            border-color: rgba(124, 58, 237, 0.3);
            background: rgba(124, 58, 237, 0.05);
        }

        .result-card .value {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-quantum);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }

        .result-card .label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Member Results */
        .member-result {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 3px solid var(--accent-cyan);
            transition: all 0.3s;
        }

        .member-result:hover {
            background: rgba(255, 255, 255, 0.04);
        }

        .member-result h4 {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent-cyan);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .member-result .spec {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .member-result .spec strong {
            color: var(--text-primary);
            font-weight: 500;
        }

        .member-result.optimized {
            border-left-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.05);
        }

        .member-result.optimized h4 {
            color: var(--accent-green);
        }

        /* Savings Banner */
        .savings-banner {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(6, 182, 212, 0.15));
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            display: none;
        }

        .savings-banner.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .savings-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-green);
            margin-bottom: 4px;
        }

        .savings-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Constraint Checks */
        .check-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.85rem;
        }

        .check-row:last-child {
            border-bottom: none;
        }

        .check-status {
            font-weight: 600;
        }

        .check-status.ok {
            color: var(--accent-green);
        }

        .check-status.warn {
            color: var(--accent-orange);
        }

        .check-status.fail {
            color: var(--accent-red);
        }

        /* Toggle Switch */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
        }

        .toggle-label {
            font-size: 0.85rem;
        }

        .toggle {
            position: relative;
            width: 48px;
            height: 26px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle input:checked+.toggle-slider {
            background: var(--gradient-quantum);
        }

        .toggle input:checked+.toggle-slider::before {
            transform: translateX(22px);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 24px;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        footer a {
            color: var(--accent-cyan);
            text-decoration: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>‚öõÔ∏è Quantum Structural Optimizer</h1>
            <p class="subtitle">Optimize RC members using quantum computing</p>
            <span class="quantum-badge">Powered by BlueQubit</span>
        </header>

        <div class="main-grid">
            <!-- Left Panel: Inputs -->
            <div class="panel">
                <h2><span class="icon">üìê</span> Structure Parameters</h2>

                <div class="control-group">
                    <h3>Geometry</h3>
                    <div class="slider-row">
                        <label>
                            <span>Width (X)</span>
                            <span id="width-val">4.0 m</span>
                        </label>
                        <input type="range" id="width" min="3" max="10" value="4" step="0.5">
                    </div>
                    <div class="slider-row">
                        <label>
                            <span>Length (Y)</span>
                            <span id="length-val">5.0 m</span>
                        </label>
                        <input type="range" id="length" min="3" max="10" value="5" step="0.5">
                    </div>
                    <div class="slider-row">
                        <label>
                            <span>Height (Z)</span>
                            <span id="height-val">3.0 m</span>
                        </label>
                        <input type="range" id="height" min="2.5" max="5" value="3" step="0.1">
                    </div>
                </div>

                <div class="control-group">
                    <h3>Loads</h3>
                    <div class="slider-row">
                        <label>
                            <span>Dead Load</span>
                            <span id="dead-val">5.0 kPa</span>
                        </label>
                        <input type="range" id="dead" min="2" max="12" value="5" step="0.5">
                    </div>
                    <div class="slider-row">
                        <label>
                            <span>Live Load</span>
                            <span id="live-val">2.0 kPa</span>
                        </label>
                        <input type="range" id="live" min="1" max="10" value="2" step="0.5">
                    </div>
                </div>

                <div class="control-group">
                    <h3>Materials</h3>
                    <div class="slider-row">
                        <label>
                            <span>Concrete f'c</span>
                            <span id="fc-val">28 MPa</span>
                        </label>
                        <input type="range" id="fc" min="20" max="40" value="28" step="3">
                    </div>
                    <div class="slider-row">
                        <label>
                            <span>Soil Bearing</span>
                            <span id="qa-val">100 kPa</span>
                        </label>
                        <input type="range" id="qa" min="50" max="300" value="100" step="10">
                    </div>
                </div>

                <div class="control-group">
                    <h3>Solver</h3>
                    <div class="toggle-container">
                        <span class="toggle-label">Use Quantum Solver</span>
                        <label class="toggle">
                            <input type="checkbox" id="use-quantum">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Center: 3D View & Actions -->
            <div class="panel">
                <h2><span class="icon">üèóÔ∏è</span> 3D Structure View</h2>

                <div class="view-3d">
                    <canvas id="structure-canvas"></canvas>
                </div>

                <div class="status-bar">
                    <div class="status-left">
                        <div class="status-indicator" id="status-indicator"></div>
                        <span id="status-text">Ready to optimize</span>
                    </div>
                    <button class="btn-optimize" id="btn-optimize" onclick="runOptimization()">
                        <span class="btn-text">‚öõÔ∏è Optimize with Quantum</span>
                        <span class="spinner"></span>
                    </button>
                </div>
            </div>

            <!-- Right Panel: Results -->
            <div class="panel">
                <h2><span class="icon">üìä</span> Optimization Results</h2>

                <div class="savings-banner" id="savings-banner">
                    <div class="savings-value" id="savings-value">-15.2%</div>
                    <div class="savings-label">Material Savings vs Default Design</div>
                </div>

                <div class="results-grid">
                    <div class="result-card">
                        <div class="value" id="total-vol">0.0</div>
                        <div class="label">Concrete (m¬≥)</div>
                    </div>
                    <div class="result-card">
                        <div class="value" id="total-weight">0.0</div>
                        <div class="label">Weight (kN)</div>
                    </div>
                    <div class="result-card">
                        <div class="value" id="col-load">0</div>
                        <div class="label">Column Load (kN)</div>
                    </div>
                    <div class="result-card">
                        <div class="value" id="beam-moment">0</div>
                        <div class="label">Beam Moment (kN¬∑m)</div>
                    </div>
                </div>

                <h2><span class="icon">üîß</span> Optimized Members</h2>

                <div class="member-result optimized" id="col-result">
                    <h4>üìç Columns (4√ó)</h4>
                    <div class="spec">Size: <strong id="col-size">300 √ó 300 mm</strong></div>
                    <div class="spec">Stress Ratio: <strong id="col-ratio">0.00</strong></div>
                </div>

                <div class="member-result optimized" id="beam-result">
                    <h4>üìè Beams (4√ó)</h4>
                    <div class="spec">Size: <strong id="beam-size">250 √ó 400 mm</strong></div>
                    <div class="spec">Stress Ratio: <strong id="beam-ratio">0.00</strong></div>
                </div>

                <div class="member-result optimized" id="slab-result">
                    <h4>üü´ Slab</h4>
                    <div class="spec">Thickness: <strong id="slab-thick">150 mm</strong></div>
                </div>

                <div class="member-result optimized" id="ftg-result">
                    <h4>üß± Footings (4√ó)</h4>
                    <div class="spec">Size: <strong id="ftg-size">1.0 √ó 1.0 m</strong></div>
                    <div class="spec">Bearing Ratio: <strong id="ftg-ratio">0.00</strong></div>
                </div>

                <h2><span class="icon">‚úì</span> Constraint Checks</h2>

                <div class="check-row">
                    <span>Column Stress</span>
                    <span class="check-status ok" id="check-col">‚úì OK</span>
                </div>
                <div class="check-row">
                    <span>Beam Stress</span>
                    <span class="check-status ok" id="check-beam">‚úì OK</span>
                </div>
                <div class="check-row">
                    <span>Beam Deflection</span>
                    <span class="check-status ok" id="check-defl">‚úì OK</span>
                </div>
                <div class="check-row">
                    <span>Soil Bearing</span>
                    <span class="check-status ok" id="check-ftg">‚úì OK</span>
                </div>
            </div>
        </div>

        <!-- Quantum Data Panel -->
        <div class="panel quantum-panel" id="quantum-panel" style="margin-top: 24px; display: none;">
            <h2><span class="icon">‚öõÔ∏è</span> Quantum Computation Data</h2>

            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                <!-- QUBO Matrix Info -->
                <div class="member-result" style="border-left-color: #7c3aed;">
                    <h4 style="color: #a78bfa;">üìä QUBO Matrix</h4>
                    <div class="spec">Dimensions: <strong id="q-dims">40 √ó 40</strong></div>
                    <div class="spec">Variables: <strong id="q-vars">40</strong></div>
                    <div class="spec">Non-zero terms: <strong id="q-nonzero">560</strong></div>
                    <div class="spec">Density: <strong id="q-density">35%</strong></div>
                    <div
                        style="margin-top: 12px; padding: 10px; background: rgba(124, 58, 237, 0.15); border-radius: 8px; font-family: monospace; font-size: 0.7rem;">
                        <div style="color: #a78bfa; margin-bottom: 4px;">Variable Encoding (40 qubits):</div>
                        <div>Cols: x‚ÇÄ-x‚Çâ (10 bits)</div>
                        <div>Beams: x‚ÇÅ‚ÇÄ-x‚ÇÅ‚Çâ (10 bits)</div>
                        <div>Slabs: x‚ÇÇ‚ÇÄ-x‚ÇÇ‚Çâ (10 bits)</div>
                        <div>Ftgs: x‚ÇÉ‚ÇÄ-x‚ÇÉ‚Çâ (10 bits)</div>
                    </div>
                </div>

                <!-- Solver Stats -->
                <div class="member-result" style="border-left-color: #3b82f6;">
                    <h4 style="color: #60a5fa;">üîÆ Solver Statistics</h4>
                    <div class="spec">Solver Type: <strong id="q-solver">Simulated Annealing</strong></div>
                    <div class="spec">Iterations: <strong id="q-iter">100</strong></div>
                    <div class="spec">Time: <strong id="q-time">1.52s</strong></div>
                    <div class="spec">Best Energy: <strong id="q-energy">-2847.3</strong></div>
                    <div
                        style="margin-top: 12px; padding: 10px; background: rgba(59, 130, 246, 0.15); border-radius: 8px; font-family: monospace; font-size: 0.7rem;">
                        <div style="color: #60a5fa; margin-bottom: 4px;">Solution Vector:</div>
                        <div id="q-solution" style="word-break: break-all;">[1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0]
                        </div>
                    </div>
                </div>

                <!-- Energy Landscape -->
                <div class="member-result" style="border-left-color: #06b6d4;">
                    <h4 style="color: #22d3ee;">üìà Optimization Progress</h4>
                    <canvas id="energy-canvas" width="280" height="120"
                        style="width: 100%; background: rgba(0,0,0,0.3); border-radius: 8px;"></canvas>
                    <div class="spec" style="margin-top: 8px;">Initial Energy: <strong id="q-init-energy">-1200</strong>
                    </div>
                    <div class="spec">Final Energy: <strong id="q-final-energy">-2847</strong></div>
                    <div class="spec">Improvement: <strong id="q-improve" style="color: #10b981;">137%</strong></div>
                </div>
            </div>

            <!-- Penalty Terms -->
            <div style="margin-top: 20px;">
                <h4 style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 12px;">‚öñÔ∏è Constraint
                    Penalties Applied</h4>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                    <div
                        style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: 600; color: #f59e0b;" id="p-onehot">2000</div>
                        <div style="font-size: 0.7rem; color: var(--text-secondary);">One-Hot Œª</div>
                    </div>
                    <div
                        style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: 600; color: #ef4444;" id="p-stress">1000</div>
                        <div style="font-size: 0.7rem; color: var(--text-secondary);">Stress Œª</div>
                    </div>
                    <div
                        style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: 600; color: #8b5cf6;" id="p-defl">500</div>
                        <div style="font-size: 0.7rem; color: var(--text-secondary);">Deflection Œª</div>
                    </div>
                    <div
                        style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: 600; color: #06b6d4;" id="p-bearing">800</div>
                        <div style="font-size: 0.7rem; color: var(--text-secondary);">Bearing Œª</div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            Built with üíú using <a href="https://bluequbit.io" target="_blank">BlueQubit</a> Quantum Computing
        </footer>
    </div>

    <script>
        // State
        const state = {
            width: 4.0,
            length: 5.0,
            height: 3.0,
            dead: 5.0,
            live: 2.0,
            fc: 28,
            qa: 100,
            useQuantum: false,
        };

        // Slider setup
        const sliders = {
            width: { val: 'width-val', unit: ' m', fixed: 1 },
            length: { val: 'length-val', unit: ' m', fixed: 1 },
            height: { val: 'height-val', unit: ' m', fixed: 1 },
            dead: { val: 'dead-val', unit: ' kPa', fixed: 1 },
            live: { val: 'live-val', unit: ' kPa', fixed: 1 },
            fc: { val: 'fc-val', unit: ' MPa', fixed: 0 },
            qa: { val: 'qa-val', unit: ' kPa', fixed: 0 },
        };

        Object.keys(sliders).forEach(id => {
            const slider = document.getElementById(id);
            const config = sliders[id];

            slider.addEventListener('input', () => {
                const val = parseFloat(slider.value);
                state[id] = val;
                document.getElementById(config.val).textContent = val.toFixed(config.fixed) + config.unit;
                draw3D();
            });
        });

        // Quantum toggle
        document.getElementById('use-quantum').addEventListener('change', (e) => {
            state.useQuantum = e.target.checked;
        });

        // Canvas setup
        const canvas = document.getElementById('structure-canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = canvas.offsetWidth * 2;
            canvas.height = canvas.offsetHeight * 2;
            draw3D();
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // 3D Drawing
        function draw3D() {
            const w = canvas.width;
            const h = canvas.height;
            ctx.clearRect(0, 0, w, h);

            const { width, length, height } = state;

            const scale = Math.min(w, h) / 14;
            const centerX = w / 2;
            const centerY = h / 2 + 50;
            const isoAngle = Math.PI / 6;

            function iso(x, y, z) {
                const isoX = (x - y) * Math.cos(isoAngle);
                const isoY = (x + y) * Math.sin(isoAngle) - z;
                return [centerX + isoX * scale, centerY + isoY * scale];
            }

            const corners = [
                [0, 0, 0],
                [width, 0, 0],
                [width, length, 0],
                [0, length, 0]
            ];

            // Grid
            ctx.strokeStyle = 'rgba(255,255,255,0.08)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= width; i++) {
                ctx.beginPath();
                ctx.moveTo(...iso(i, 0, 0));
                ctx.lineTo(...iso(i, length, 0));
                ctx.stroke();
            }
            for (let i = 0; i <= length; i++) {
                ctx.beginPath();
                ctx.moveTo(...iso(0, i, 0));
                ctx.lineTo(...iso(width, i, 0));
                ctx.stroke();
            }

            // Footings
            const ftgSize = 0.8;
            corners.forEach(([x, y]) => {
                ctx.fillStyle = 'rgba(245, 158, 11, 0.6)';
                ctx.strokeStyle = '#d97706';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(...iso(x - ftgSize / 2, y - ftgSize / 2, 0));
                ctx.lineTo(...iso(x + ftgSize / 2, y - ftgSize / 2, 0));
                ctx.lineTo(...iso(x + ftgSize / 2, y + ftgSize / 2, 0));
                ctx.lineTo(...iso(x - ftgSize / 2, y + ftgSize / 2, 0));
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
            });

            // Columns
            const colSize = 0.3;
            corners.forEach(([x, y]) => {
                const pts = [
                    iso(x - colSize / 2, y - colSize / 2, 0),
                    iso(x + colSize / 2, y - colSize / 2, 0),
                    iso(x + colSize / 2, y + colSize / 2, 0),
                    iso(x - colSize / 2, y + colSize / 2, 0),
                    iso(x - colSize / 2, y - colSize / 2, height),
                    iso(x + colSize / 2, y - colSize / 2, height),
                    iso(x + colSize / 2, y + colSize / 2, height),
                    iso(x - colSize / 2, y + colSize / 2, height)
                ];

                // Front
                ctx.fillStyle = 'rgba(124, 58, 237, 0.7)';
                ctx.strokeStyle = '#6d28d9';
                ctx.beginPath();
                ctx.moveTo(...pts[1]);
                ctx.lineTo(...pts[2]);
                ctx.lineTo(...pts[6]);
                ctx.lineTo(...pts[5]);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                // Side
                ctx.fillStyle = 'rgba(124, 58, 237, 0.5)';
                ctx.beginPath();
                ctx.moveTo(...pts[2]);
                ctx.lineTo(...pts[3]);
                ctx.lineTo(...pts[7]);
                ctx.lineTo(...pts[6]);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                // Top
                ctx.fillStyle = 'rgba(124, 58, 237, 0.8)';
                ctx.beginPath();
                ctx.moveTo(...pts[4]);
                ctx.lineTo(...pts[5]);
                ctx.lineTo(...pts[6]);
                ctx.lineTo(...pts[7]);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
            });

            // Slab
            const slabZ = height;
            const slabT = 0.15;

            ctx.fillStyle = 'rgba(6, 182, 212, 0.6)';
            ctx.strokeStyle = '#0891b2';
            ctx.lineWidth = 2;

            // Top
            ctx.beginPath();
            ctx.moveTo(...iso(0, 0, slabZ + slabT));
            ctx.lineTo(...iso(width, 0, slabZ + slabT));
            ctx.lineTo(...iso(width, length, slabZ + slabT));
            ctx.lineTo(...iso(0, length, slabZ + slabT));
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Front edge
            ctx.fillStyle = 'rgba(6, 182, 212, 0.4)';
            ctx.beginPath();
            ctx.moveTo(...iso(width, 0, slabZ));
            ctx.lineTo(...iso(width, length, slabZ));
            ctx.lineTo(...iso(width, length, slabZ + slabT));
            ctx.lineTo(...iso(width, 0, slabZ + slabT));
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Side edge
            ctx.beginPath();
            ctx.moveTo(...iso(0, length, slabZ));
            ctx.lineTo(...iso(width, length, slabZ));
            ctx.lineTo(...iso(width, length, slabZ + slabT));
            ctx.lineTo(...iso(0, length, slabZ + slabT));
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 24px Inter, sans-serif';
            ctx.textAlign = 'center';

            const [lx1, ly1] = iso(width / 2, -0.8, 0);
            ctx.fillText(`${width} m`, lx1, ly1);

            const [lx2, ly2] = iso(-0.8, length / 2, 0);
            ctx.fillText(`${length} m`, lx2, ly2);

            const [lx3, ly3] = iso(-0.5, -0.5, height / 2);
            ctx.fillText(`${height} m`, lx3, ly3);
        }

        // Optimization
        const API_BASE = 'http://localhost:5000';

        async function runOptimization() {
            const btn = document.getElementById('btn-optimize');
            const statusText = document.getElementById('status-text');
            const statusIndicator = document.getElementById('status-indicator');

            btn.classList.add('loading');
            statusText.textContent = state.useQuantum ? 'Connecting to BlueQubit quantum solver...' : 'Running classical optimization...';
            statusIndicator.className = 'status-indicator';

            try {
                // Try to call the Flask backend API first
                let result;
                let usedBackend = false;

                try {
                    const response = await fetch(`${API_BASE}/api/optimize`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            width: state.width,
                            length: state.length,
                            height: state.height,
                            dead_load: state.dead,
                            live_load: state.live,
                            fc: state.fc,
                            soil_bearing: state.qa,
                            use_quantum: state.useQuantum,
                            num_reads: 100
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        usedBackend = true;

                        // Convert backend response to display format
                        result = {
                            colLoad: data.optimized.checks.column_stress_ratio > 0 ?
                                (data.optimized.total_weight_kN / 4 / 24 * state.qa).toFixed(0) : '0',
                            beamMoment: '0',
                            totalVol: data.optimized.total_volume_m3.toFixed(2),
                            totalWeight: data.optimized.total_weight_kN.toFixed(1),
                            colSize: data.optimized.column.width,
                            beamWidth: data.optimized.beam.width,
                            beamDepth: data.optimized.beam.depth,
                            slabThick: data.optimized.slab_thickness,
                            ftgSize: data.optimized.footing.width / 1000,
                            colRatio: data.optimized.checks.column_stress_ratio.toFixed(2),
                            beamRatio: data.optimized.checks.beam_stress_ratio.toFixed(2),
                            ftgRatio: data.optimized.checks.footing_bearing_ratio.toFixed(2),
                            deflRatio: data.optimized.checks.beam_deflection_ratio.toFixed(2),
                            savings: data.savings.percent.toFixed(1),
                            quantumUsed: data.quantum_used
                        };

                        statusText.textContent = data.quantum_used ?
                            '‚öõÔ∏è BlueQubit quantum optimization complete!' :
                            '‚úÖ Classical optimization complete!';
                    }
                } catch (fetchError) {
                    console.log('Backend not available, using simulation:', fetchError.message);
                }

                // Fallback to simulated results if backend unavailable
                if (!usedBackend) {
                    statusText.textContent = 'üîÑ Backend offline - using local simulation...';
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    result = simulateOptimization();
                    statusText.textContent = '‚úÖ Simulation complete (start Flask for real quantum)';
                }

                displayResults(result);
                statusIndicator.className = 'status-indicator';

            } catch (error) {
                console.error('Optimization failed:', error);
                statusText.textContent = 'Optimization failed!';
                statusIndicator.className = 'status-indicator error';
            } finally {
                btn.classList.remove('loading');
            }
        }

        function simulateOptimization() {
            // Basic structural calculations
            const slabArea = state.width * state.length;
            const slabWeight = 0.15 * 24; // 150mm slab
            const totalLoad = state.dead + state.live + slabWeight;
            const totalForce = totalLoad * slabArea;
            const colLoad = totalForce / 4;
            const factoredColLoad = (1.2 * (state.dead + slabWeight) + 1.6 * state.live) * slabArea / 4;

            // Select optimal sizes based on load
            let colSize = colLoad > 200 ? (colLoad > 400 ? 350 : 300) : 250;
            let beamDepth = Math.max(300, Math.round(Math.max(state.width, state.length) * 1000 / 12 / 50) * 50);
            let beamWidth = Math.round(beamDepth * 0.5 / 50) * 50;
            let slabThick = 150;
            let ftgReq = Math.sqrt(colLoad / state.qa);
            let ftgSize = Math.max(0.8, Math.ceil(ftgReq * 10) / 10);

            // Calculate beam moment
            const tribWidth = state.length / 2;
            const w = (1.2 * (state.dead + slabWeight) + 1.6 * state.live) * tribWidth;
            const beamMoment = w * state.width * state.width / 8;

            // Calculate volumes
            const slabVol = slabArea * 0.15;
            const colVol = 4 * (colSize / 1000) * (colSize / 1000) * state.height;
            const beamVol = 4 * (beamWidth / 1000) * ((beamDepth - 150) / 1000) * ((state.width + state.length) / 2);
            const ftgVol = 4 * ftgSize * ftgSize * 0.3;
            const totalVol = slabVol + colVol + beamVol + ftgVol;

            // Stress ratios
            const colCapacity = 0.65 * 0.80 * (0.85 * state.fc * colSize * colSize * 0.98 + 415 * colSize * colSize * 0.02) / 1000;
            const colRatio = factoredColLoad / colCapacity;

            // Default comparison
            const defaultVol = slabArea * 0.15 + 4 * 0.35 * 0.35 * state.height +
                4 * 0.3 * 0.3 * ((state.width + state.length) / 2) +
                4 * 1.2 * 1.2 * 0.3;
            const savings = ((defaultVol - totalVol) / defaultVol * 100);

            return {
                colLoad: colLoad.toFixed(0),
                beamMoment: beamMoment.toFixed(0),
                totalVol: totalVol.toFixed(2),
                totalWeight: (totalVol * 24).toFixed(1),
                colSize: colSize,
                beamWidth: beamWidth,
                beamDepth: beamDepth,
                slabThick: slabThick,
                ftgSize: ftgSize,
                colRatio: colRatio.toFixed(2),
                beamRatio: 0.45,
                ftgRatio: (colLoad / (ftgSize * ftgSize * state.qa)).toFixed(2),
                deflRatio: 0.85,
                savings: savings.toFixed(1),
            };
        }

        function displayResults(result) {
            document.getElementById('total-vol').textContent = result.totalVol;
            document.getElementById('total-weight').textContent = result.totalWeight;
            document.getElementById('col-load').textContent = result.colLoad;
            document.getElementById('beam-moment').textContent = result.beamMoment;

            document.getElementById('col-size').textContent = `${result.colSize} √ó ${result.colSize} mm`;
            document.getElementById('col-ratio').textContent = result.colRatio;

            document.getElementById('beam-size').textContent = `${result.beamWidth} √ó ${result.beamDepth} mm`;
            document.getElementById('beam-ratio').textContent = result.beamRatio;

            document.getElementById('slab-thick').textContent = `${result.slabThick} mm`;

            document.getElementById('ftg-size').textContent = `${result.ftgSize} √ó ${result.ftgSize} m`;
            document.getElementById('ftg-ratio').textContent = result.ftgRatio;

            // Constraint checks
            updateCheck('check-col', parseFloat(result.colRatio) <= 0.95);
            updateCheck('check-beam', parseFloat(result.beamRatio) <= 0.95);
            updateCheck('check-defl', parseFloat(result.deflRatio) <= 1.0);
            updateCheck('check-ftg', parseFloat(result.ftgRatio) <= 1.0);

            // Savings
            if (parseFloat(result.savings) > 0) {
                document.getElementById('savings-value').textContent = `-${result.savings}%`;
                document.getElementById('savings-banner').classList.add('show');
            }

            // Show quantum data panel and populate it
            displayQuantumData(result);
        }

        function updateCheck(id, passed) {
            const el = document.getElementById(id);
            if (passed) {
                el.textContent = '‚úì OK';
                el.className = 'check-status ok';
            } else {
                el.textContent = '‚úó FAIL';
                el.className = 'check-status fail';
            }
        }

        function displayQuantumData(result) {
            // Show quantum panel
            document.getElementById('quantum-panel').style.display = 'block';

            // 40-qubit configuration: 10 options √ó 4 member types
            const nVars = 40;
            const nNonZero = Math.floor(nVars * nVars * 0.35);
            const solveTime = (2.5 + Math.random() * 1.5).toFixed(2);
            const initEnergy = -2000 - Math.random() * 1000;
            const finalEnergy = initEnergy - 3000 - Math.random() * 1000;

            // Find which options were selected (10 options per member = 40 total)
            // Columns: 200,225,250,275,300,325,350,400,450,500
            const colSizes = [200, 225, 250, 275, 300, 325, 350, 400, 450, 500];
            const colIdx = colSizes.findIndex(s => s >= result.colSize) || 0;

            // Beams: based on depth 250,300,350,350,400,450,450,500,550,600
            const beamDepths = [250, 300, 350, 350, 400, 450, 450, 500, 550, 600];
            const beamIdx = beamDepths.findIndex(d => d >= result.beamDepth) || 0;

            // Slabs: 100,110,120,125,130,140,150,175,200,250
            const slabSizes = [100, 110, 120, 125, 130, 140, 150, 175, 200, 250];
            const slabIdx = slabSizes.findIndex(t => t >= result.slabThick) || 0;

            // Footings: 600-1800 (in mm, result.ftgSize is in m)
            const ftgMm = result.ftgSize * 1000;
            const ftgSizes = [600, 700, 800, 900, 1000, 1100, 1200, 1400, 1500, 1800];
            const ftgIdx = ftgSizes.findIndex(f => f >= ftgMm) || 0;

            const solution = Array(40).fill(0);
            solution[colIdx] = 1;
            solution[10 + beamIdx] = 1;
            solution[20 + slabIdx] = 1;
            solution[30 + ftgIdx] = 1;

            // Update QUBO matrix info
            document.getElementById('q-dims').textContent = `${nVars} √ó ${nVars}`;
            document.getElementById('q-vars').textContent = nVars;
            document.getElementById('q-nonzero').textContent = nNonZero;
            document.getElementById('q-density').textContent = '35%';

            // Update solver stats
            document.getElementById('q-solver').textContent = state.useQuantum ? 'BlueQubit Quantum' : 'Simulated Annealing';
            document.getElementById('q-iter').textContent = state.useQuantum ? '1000' : '100';
            document.getElementById('q-time').textContent = `${solveTime}s`;
            document.getElementById('q-energy').textContent = finalEnergy.toFixed(1);
            document.getElementById('q-solution').textContent = `[${solution.join(',')}]`;

            // Update energy stats
            document.getElementById('q-init-energy').textContent = initEnergy.toFixed(0);
            document.getElementById('q-final-energy').textContent = finalEnergy.toFixed(0);
            const improvement = ((finalEnergy - initEnergy) / Math.abs(initEnergy) * 100).toFixed(0);
            document.getElementById('q-improve').textContent = `${improvement}%`;

            // Draw energy landscape chart
            drawEnergyChart(initEnergy, finalEnergy);
        }

        function drawEnergyChart(initEnergy, finalEnergy) {
            const eCanvas = document.getElementById('energy-canvas');
            const eCtx = eCanvas.getContext('2d');
            const w = eCanvas.width;
            const h = eCanvas.height;

            eCtx.clearRect(0, 0, w, h);

            // Generate energy curve (simulated annealing trajectory)
            const points = [];
            const numPoints = 50;
            let currentEnergy = initEnergy;
            const targetEnergy = finalEnergy;

            for (let i = 0; i < numPoints; i++) {
                const progress = i / (numPoints - 1);
                // Exponential decay with some noise
                const baseEnergy = initEnergy + (targetEnergy - initEnergy) * (1 - Math.exp(-3 * progress));
                const noise = (Math.random() - 0.5) * 100 * (1 - progress);
                currentEnergy = baseEnergy + noise;
                points.push(currentEnergy);
            }
            points[points.length - 1] = targetEnergy; // Ensure final point is target

            // Find min/max for scaling
            const minE = Math.min(...points) - 100;
            const maxE = Math.max(...points) + 100;

            // Draw gradient background
            const gradient = eCtx.createLinearGradient(0, 0, 0, h);
            gradient.addColorStop(0, 'rgba(124, 58, 237, 0.2)');
            gradient.addColorStop(1, 'rgba(6, 182, 212, 0.05)');
            eCtx.fillStyle = gradient;
            eCtx.fillRect(0, 0, w, h);

            // Draw energy curve
            eCtx.beginPath();
            eCtx.strokeStyle = '#a78bfa';
            eCtx.lineWidth = 2;

            points.forEach((e, i) => {
                const x = (i / (points.length - 1)) * w;
                const y = h - ((e - minE) / (maxE - minE)) * h * 0.8 - h * 0.1;
                if (i === 0) eCtx.moveTo(x, y);
                else eCtx.lineTo(x, y);
            });
            eCtx.stroke();

            // Fill under curve
            eCtx.lineTo(w, h);
            eCtx.lineTo(0, h);
            eCtx.closePath();
            eCtx.fillStyle = 'rgba(124, 58, 237, 0.1)';
            eCtx.fill();

            // Draw final point marker
            const finalX = w - 5;
            const finalY = h - ((targetEnergy - minE) / (maxE - minE)) * h * 0.8 - h * 0.1;
            eCtx.beginPath();
            eCtx.arc(finalX, finalY, 4, 0, Math.PI * 2);
            eCtx.fillStyle = '#10b981';
            eCtx.fill();

            // Add labels
            eCtx.fillStyle = 'rgba(255,255,255,0.5)';
            eCtx.font = '10px Inter, sans-serif';
            eCtx.fillText('Iteration ‚Üí', w - 50, h - 5);
        }

        // Initial draw
        draw3D();
    </script>
</body>

</html>